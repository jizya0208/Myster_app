<div class="container">
  <div class="row">
    <div class="col-lg-10 article-content">
      <div class="row">
        <div class="col-md-2 col-sm-4 article-content__date text-right"><p class="date pr-3"><%= @article.created_at.strftime('%Y') %><span><%= @article.created_at.strftime('%m/%d') %></span></p></div>
        <div class="col-lg-10 article-content__heading text-center", id="article_<%= @article.id %>">
          <h3>Title: <%= @article.title %></h3>
          <ul class="text-right">
            <li>category: <%= @article.category.name %></li>
            <li class="favorite-btn"><%= render 'favorites/favorite-btn', article: @article %></li> <!--お気に入りパーシャル呼び出し-->
            <% if current_member_has?(@article) %>      <!--「ログインユーザと投稿者が同一か」で条件分岐(application_helperで定義)-->
              <li><%= link_to '', article_path(@article), method: :delete, data: { confirm: 'この投稿を削除しますか？', cancel: 'キャンセル',commit: 'OK'}, title: '投稿削除', class: "destroy_article_#{@article.id} fas fa-trash-alt" %></li>
              <% if @article.is_closed == false %>      <!--上記且つ、相談ステータスが相談中の場合、更新ボタンを表示-->
                <li><%= link_to '', article_path(@article), method: :patch, data: { confirm: 'ステータス解決済みにすると回答募集ページへの掲示を終了します。本当によろしいですか？', cancel: 'キャンセル',commit: 'OK' }, title: '相談ステータス更新', class: "update_article_#{@article.id} fas fa-check-circle"%></li>
              <% end %>
            <% end %>
            <li>by <%= link_to @article.member.name, member_path(@article.member) %></li>
          </ul>
        </div>
        <div class="row">
          <div class="col-lg-6 article-img">
            <% if @article.article_images.present? %>
              <ul id="slider">
                <% @article.article_images.each do |article_image| %>
                  <li class="slide-item">
                    <%= attachment_image_tag article_image, :image, :fill, 300, 400, format: 'png' %>
                  </li>
                <% end %>
              </ul>
              <ul id="thumbnail-list">
                <% @article.article_images.each do |article_image| %>
                  <li class="thumbnail-item my-3">
                    <%= attachment_image_tag article_image, :image, :fill, 80, 100, format: 'png' %>
                  </li>
                <% end %>
              </ul>
            <% else %>
              <div class="article--no-img">
                <%= image_tag 'no-image.png' %>
              </div>
            <% end %>
            <div class="tag-box">
              <% @article.tags.each do |tag| %>
                <span class="label"><%= link_to tag.name, "/article/tag/#{tag.name}" %></span>
              <% end %>
            </div>
          </div>
        <div class="col-lg-6 ">
            <h4>Text</h4>
            <% article_body = safe_join(@article.body.split("\n"), tag(:br)) %>　<!--改行には<br>を付与し、段落を反映して変数に代入。-->
            <div class="my-3"><%= render_with_tags(article_body) %></div>        <!--上記を評価し、ハッシュタグにリンクを付与-->

            <h4 class="my-3"><span class="comments-count"><%= @article.article_comments.count %></span> Comments</h4>
            <table class="article-comment-content table table-md">
              <%= render partial: 'article_comments/index', locals: { :article => @article, :article_comment => @article_comment } %>
            </table>
            <p class="mt-3">コメントフォーム</p>
            <%= form_with model:[@article,@article_comment] do |f| %>  <!--新規コメントフォーム。インスタンス変数を2つ渡すことで、どの投稿に結びつくコメントかよしなに見つけてくれる-->
              <%= f.text_area :body, size: "40x5" %>
              <%= f.label :image, class: "fas fa-image image-form" do %>
                画像をアップロード
                <%= f.attachment_field :image %>
              <% end %>
              <div class="text-center">
                <%= f.submit '送信', class: "btn bnt-sm btn-danger" %>
              </div>
            <% end %>

            <% if current_member_has?(@article) %>    <!--ログインユーザと投稿者が同一の場合、円グラフを表示-->
              <p class="mt-3">お気に入り登録したユーザ層(こちらは投稿者本人のみ閲覧できます)</p>
              <div class="col-8 offset-2 pie my-1">
                <%= pie_chart @attribute_ratio, donut: true, suffix: "%" %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-2 col-sm-4 side-bar">
      <%= render 'members/info', member: current_member %>
    </div>
  </div>
</div>
