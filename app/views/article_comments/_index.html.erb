  <!-- コメント一覧,コメントフォーム,コメントへの星評価  articles showで使用 -->
  <% parent_comments.each do |parent_comment| %>
    <div class="row d-flex align-items-center py-3"> <!--要素の高さ中央揃え-->
      <div class="col font-weight-bold">
        <%= link_to member_path(parent_comment.member) do %>
          <%= attachment_image_tag(parent_comment.member, :image, :fill, 40, 40, format: 'png', fallback: "no-image-icon.png", size: '40x40') %>
          <%= parent_comment.member.name %>さん
        <% end %>
      </div>
      <div class="col align-items-center text-right font-weight-bold">
        <%= parent_comment.created_at.strftime("%Y/%-m/%-d %H:%M") %>
      </div>
    </div>
    <div class="card-body border border-secondary rounded-lg bg-white">
      <%= safe_join(parent_comment.body.split("\n"), tag(:br)) %>       <!--改行(\n)にはhtmlタグ<br>を付与し、段落を反映して表示する。-->
      <% unless article.is_closed.nil? %>                               <!--相談ステータスが空でない限り、回答に紐づく評価を表示-->
        <div class="instruction--sm-grey text-right">星5つ中の平均値(<%= parent_comment.ratings.count %>件)</div>
        <div class="rate--average text-right" id="star-rate-<%= parent_comment.id %>"></div>
        <%= render 'articles/average_star', parent_comment: parent_comment %>
      <% end %>
      <% if current_member == parent_comment.member %>　<!--コメント投稿者には削除ボタンを表示させる-->
        <div class="text-right">
          <%= link_to ' 削除', article_article_comment_path(article.id, parent_comment.id), class: 'fas fa-trash-alt btn btn-sm btn-outline-secondary', method: :delete, remote: true %>
        </div>
      <% end %>
    </div>

    <!-------------------------------------------------コメントへの星評価---------------------------------------------------------- ------>
    <% if other_member?(parent_comment.member) && !(article.is_closed.nil?) %> <!--自分のコメントへの評価不可、相談ステータスのない投稿に紐づくコメントへの評価不可-->
      <% if parent_comment.rated_by?(current_member) %>                         <!--評価済みか否かで条件分岐-->
        <% @rated = Rating.find_by(member_id: current_member, article_comment_id: parent_comment.id) %>
        <%= render 'articles/rerate', parent_comment: parent_comment %>
      <% elsif parent_comment.member != current_member %>                       <!--未評価の場合  -->
        <%= render 'articles/rate', parent_comment: parent_comment %>
      <% end %>
    <% end %>

    <!-------------------------------------------コメントへの返信一覧 & 返信フォーム------------------------------------------------------>
    <div class="accordion-container">     <!--accordion-containerの中にtitleとcontentを配置-->
      <div class="accordion-title text-center py-3 js-accordion-title">
        <span class="article-content__commentCount"><%= parent_comment.replies.count %> 件の返信</span>
      </div>
      <div class="accordion-content">
      <% if parent_comment.replies.exists? %>
        <% parent_comment.replies.each do |reply| %>
          <div class="row d-flex align-items-center ml-3"> <!--要素の高さ中央揃え-->
            <div class="col font-weight-bold">
              <%= link_to member_path(reply.member) do %>
                <%= attachment_image_tag(reply.member, :image, :fill, 40, 40, format: 'png', fallback: "no-image-icon.png", size: '40x40') %>
                <%= reply.member.name %>さん
              <% end %>
            </div>
            <div class="col align-items-center text-right font-weight-bold">
              <%= reply.created_at.strftime("%Y/%-m/%-d %H:%M") %>
            </div>
          </div>
          <div class="card-body border border-secondary rounded-lg bg-white ml-4">
            <%= safe_join(reply.body.split("\n"), tag(:br)) %> <!--改行(\n)にはhtmlタグ<br>を付与し、段落を反映して表示する。-->
            <% if current_member == reply.member %>　<!--コメント投稿者には削除ボタンを表示させる-->
              <div class="text-right">
                <%= link_to ' 削除', article_article_comment_path(article.id, reply.id), class: 'fas fa-trash-alt btn btn-sm btn-outline-secondary', method: :delete, remote: true %>
              </div>
            <% end %>
          </div>
        <% end %>
      <% end %>
      <!--各コメントへの返信フォーム-->
      <%= form_with model:[article, article_comment_reply] do |f| %>
        <div class="border-top border-secondary mt-4 ml-4">
          <%= f.label :body, 'コメントに返信する', class: "instruction--sm-grey" %>
          <%= f.text_area :body, class: "col card-body border-dark rounded-lg", autofocus: true, placeholder: "コメントに返信してみましょう" %>
          <div class="text-right py-2">
            <%= f.attachment_field :image %>
            <%= f.hidden_field :parent_id, value: parent_comment.id %>
            <%= f.submit '返信する', class: "btn btn-sm btn-danger" %>
          </div>
        </div>
      <% end %>
      </div>
    </div>
  <% end %>
